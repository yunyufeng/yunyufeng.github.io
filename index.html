<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å·¥å…·å¯¼èˆª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.6;
        }

        .stats {
            display: inline-flex;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .tools-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tools-header h2 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .tools-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .search-box {
            position: relative;
            max-width: 500px;
            margin: 0 auto 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.2rem;
        }

        .category-filter {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .category-btn:hover, .category-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .tool-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .tool-card.featured {
            border-color: #ff6b6b;
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3);
        }

        .tool-card.featured::before {
            content: "ğŸ”¥ çƒ­é—¨";
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
        }

        .tool-icon {
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            position: relative;
            overflow: hidden;
        }

        .tool-icon::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
        }

        .tool-info {
            padding: 20px;
        }

        .tool-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tool-name a {
            color: inherit;
            text-decoration: none;
            flex: 1;
        }

        .tool-name a:hover {
            color: #667eea;
        }

        .tool-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            vertical-align: middle;
        }

        .status-new {
            background: #4caf50;
            color: white;
        }

        .status-popular {
            background: #ff9800;
            color: white;
        }

        .status-config {
            background: #667eea;
            color: white;
        }

        .tool-description {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
            min-height: 50px;
            font-size: 0.95rem;
        }

        .tool-features {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .feature-tag {
            background: #f0f4ff;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 10px 15px;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f4ff;
            color: #667eea;
        }

        .btn-secondary:hover {
            background: #e0e7ff;
        }

        .refresh-btn {
            display: block;
            margin: 20px auto 0;
            padding: 10px 25px;
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .no-tools {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            grid-column: 1 / -1;
        }

        .no-tools-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .loading {
            text-align: center;
            padding: 40px;
            grid-column: 1 / -1;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .status-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .config-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 0;
            margin-bottom: 20px;
            display: none;
        }

        .config-header {
            padding: 12px 20px;
            background: #f0f4ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e7ff;
        }

        .config-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-close {
            background: #667eea;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        .config-content {
            padding: 20px;
        }

        .config-form {
            display: grid;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .config-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .config-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        .save-config {
            background: #667eea;
            color: white;
        }

        .save-config:hover {
            background: #5769cf;
        }

        .cancel-config {
            background: #f0f0f0;
            color: #666;
        }

        .cancel-config:hover {
            background: #e6e6e6;
        }

        .delete-config {
            background: #ff6b6b;
            color: white;
        }

        .delete-config:hover {
            background: #ff5252;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #ccc;
        }
        
        .upload-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .upload-header h3 {
            color: #333;
            margin: 0;
            font-size: 1.1rem;
        }
        
        .upload-form {
            display: grid;
            gap: 10px;
        }
        
        .upload-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .upload-file {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            background: white;
        }
        
        .upload-btn {
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #45a049;
        }
        
        .upload-btn.view {
            background: #667eea;
        }
        
        .upload-btn.view:hover {
            background: #5769cf;
        }
        
        .upload-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .upload-help::before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }
        
        .upload-status {
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .upload-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .upload-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .config-download {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .config-download:hover {
            background: #45a049;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .tools-header h2 {
                font-size: 1.6rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 8px;
            }
            
            .upload-inputs {
                flex-direction: column;
            }
            
            .upload-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ› ï¸ åœ¨çº¿å·¥å…·é›†åˆ</h1>
            <p>åŸºäºé…ç½®æ–‡ä»¶çš„å·¥å…·å¯¼èˆªç³»ç»Ÿ</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalTools">0</div>
                    <div class="stat-label">å·¥å…·æ•°é‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="htmlFiles">0</div>
                    <div class="stat-label">HTMLæ–‡ä»¶</div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- ä¸Šä¼ HTMLæ–‡ä»¶éƒ¨åˆ† -->
            <div class="upload-section">
                <div class="upload-header">
                    <h3>ğŸ“¤ ä¸Šä¼ HTMLæ–‡ä»¶åˆ°GitHub</h3>
                </div>
                <div class="upload-form">
                    <div class="upload-inputs">
                        <input type="file" class="upload-file" id="htmlFileInput" accept=".html,.htm">
                        <button class="upload-btn" onclick="uploadHTMLFile()">ä¸Šä¼ åˆ°GitHub</button>
                        <button class="upload-btn view" onclick="listRepositoryFiles()">æŸ¥çœ‹ä»“åº“æ–‡ä»¶</button>
                    </div>
                    <div class="upload-help">
                        é€‰æ‹©æœ¬åœ°çš„HTMLæ–‡ä»¶ä¸Šä¼ åˆ°GitHubä»“åº“ï¼Œä¸Šä¼ åè¯·åˆ·æ–°å·¥å…·åˆ—è¡¨
                    </div>
                    <div class="upload-status" id="uploadStatus"></div>
                </div>
            </div>

            <!-- é…ç½®é¢æ¿ - é»˜è®¤éšè— -->
            <div class="config-panel" id="configPanel">
                <div class="config-header">
                    <div class="config-title">
                        <span>âš™ï¸</span> å·¥å…·é…ç½®ç®¡ç†å™¨
                    </div>
                    <button class="config-close" onclick="hideConfigPanel()">Ã—</button>
                </div>
                <div class="config-content">
                    <div class="config-form" id="configForm">
                        <!-- é…ç½®è¡¨å•å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <button class="config-download" onclick="saveConfigToGitHub()">
                        ğŸ’¾ ä¿å­˜é…ç½®åˆ°GitHubä»“åº“
                    </button>
                </div>
            </div>

            <div class="tools-header">
                <h2>ğŸš€ å·¥å…·å¯¼èˆª</h2>
                <p>ä» tools-config.json åŠ è½½å·¥å…·é…ç½®</p>
            </div>

            <div class="search-box">
                <div class="search-icon">ğŸ”</div>
                <input type="text" id="searchInput" placeholder="æœç´¢å·¥å…·åç§°..." oninput="searchTools()">
            </div>

            <div class="category-filter">
                <button class="category-btn active" onclick="filterTools('all')">å…¨éƒ¨å·¥å…·</button>
                <button class="category-btn" onclick="filterTools('popular')">çƒ­é—¨å·¥å…·</button>
                <button class="category-btn" onclick="filterTools('pdf')">PDFå·¥å…·</button>
                <button class="category-btn" onclick="filterTools('game')">æ¸¸æˆ</button>
                <button class="category-btn" onclick="filterTools('education')">æ•™è‚²å·¥å…·</button>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="loading" id="loadingIndicator" style="display: none;">
                <div class="spinner"></div>
                <p>æ­£åœ¨åŠ è½½å·¥å…·åˆ—è¡¨...</p>
            </div>

            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div class="status-message" id="statusMessage"></div>

            <!-- å·¥å…·åˆ—è¡¨ -->
            <div class="tools-grid" id="toolsGrid">
                <!-- åŠ¨æ€ç”Ÿæˆå·¥å…·å¡ç‰‡ -->
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="refresh-btn" onclick="loadFiles()" style="margin-right: 10px;">
                    ğŸ”„ åˆ·æ–°å·¥å…·åˆ—è¡¨
                </button>
                <button class="refresh-btn" onclick="showNewToolForm()" style="background: #667eea;">
                    â• æ·»åŠ æ–°å·¥å…·é…ç½®
                </button>
            </div>
        </main>

        <footer>
            <p>Â© 2025 åœ¨çº¿å·¥å…·é›†åˆ | ä½œè€…: pangyu</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let allTools = [];
        let toolConfigs = {};
        let repositoryFiles = [];
        let currentFilter = 'all';
        let currentSearch = '';
        
        // GitHub API é…ç½®
        const GITHUB_TOKEN = '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';
        const REPO_OWNER = 'yunyufeng';
        const REPO_NAME = 'yunyufeng.github.io';
        const BRANCH = 'main';

        // é¡µé¢åŠ è½½æ—¶éªŒè¯Token
document.addEventListener('DOMContentLoaded', async function() {
    console.log('éªŒè¯GitHub Token...');
    const tokenStatus = await validateGitHubToken();
    
    if (tokenStatus.valid) {
        console.log('âœ… GitHub Tokenæœ‰æ•ˆï¼Œç”¨æˆ·:', tokenStatus.user);
        showStatus(`GitHubè¿æ¥æˆåŠŸ (ç”¨æˆ·: ${tokenStatus.user})`, 'success');
    } else {
        console.log('âŒ GitHub Tokenæ— æ•ˆ:', tokenStatus.error);
        showStatus(`GitHubè¿æ¥å¤±è´¥: ${tokenStatus.error}`, 'error');
    }
    
    loadToolConfigs();
});
// æ£€æŸ¥Tokenæ ¼å¼å¹¶å¤„ç†
function getGitHubHeaders() {
    // æ¸…ç†Tokenï¼Œç§»é™¤å¯èƒ½çš„ç©ºæ ¼æˆ–æ¢è¡Œ
    const cleanToken = GITHUB_TOKEN.trim();
    
    return {
        'Authorization': `token ${cleanToken}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json',
        'User-Agent': 'Tool-Navigation-App'
    };
}
        // åŠ è½½å·¥å…·é…ç½®
        async function loadToolConfigs() {
            console.log('æ­£åœ¨åŠ è½½ tools-config.json æ–‡ä»¶...');
            try {
                const response = await fetch('tools-config.json');
                if (response.ok) {
                    toolConfigs = await response.json();
                    console.log('âœ… é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ:', toolConfigs);
                    showStatus('é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ', 'success');
                    loadFiles(); // åŠ è½½ä»“åº“æ–‡ä»¶
                } else {
                    console.log('âš ï¸ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨');
                    toolConfigs = {};
                    showStatus('é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·åˆ›å»ºé…ç½®', 'info');
                    loadFiles();
                }
            } catch (error) {
                console.log('âŒ é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥:', error);
                toolConfigs = {};
                showStatus('é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥', 'error');
                loadFiles();
            }
        }

        // åŠ è½½ä»“åº“æ–‡ä»¶åˆ—è¡¨
        async function loadFiles() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            const statusMessage = document.getElementById('statusMessage');
            const toolsGrid = document.getElementById('toolsGrid');
            const totalTools = document.getElementById('totalTools');
            const htmlFiles = document.getElementById('htmlFiles');

            loadingIndicator.style.display = 'block';
            statusMessage.style.display = 'none';
            statusMessage.className = 'status-message';
            toolsGrid.innerHTML = '';

            try {
                console.log('æ­£åœ¨ä»GitHubè·å–ä»“åº“æ–‡ä»¶...');
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents?ref=${BRANCH}`);
                if (!response.ok) {
                    throw new Error(`GitHub APIé”™è¯¯: ${response.status}`);
                }

                const files = await response.json();
                repositoryFiles = files;
                
                // è¿‡æ»¤å‡ºHTMLæ–‡ä»¶å¹¶æ’é™¤index.html
                const htmlFilesInRepo = files.filter(file => 
                    file.name.endsWith('.html') && 
                    file.name !== 'index.html'
                );

                console.log('ğŸ“ ä»“åº“ä¸­çš„HTMLæ–‡ä»¶:', htmlFilesInRepo.map(f => f.name));

                // ä»é…ç½®æ–‡ä»¶åˆ›å»ºå·¥å…·åˆ—è¡¨
                allTools = htmlFilesInRepo.map(file => {
                    const config = toolConfigs[file.name] || {};
                    
                    // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰è¿™ä¸ªå·¥å…·çš„é…ç½®ï¼Œä½¿ç”¨é…ç½®
                    if (Object.keys(config).length > 0) {
                        console.log(`ä½¿ç”¨é…ç½®æ˜¾ç¤º: ${file.name}`, config);
                        return {
                            name: config.name || file.name.replace('.html', ''),
                            description: config.description || 'å®ç”¨çš„åœ¨çº¿å·¥å…·',
                            icon: config.icon || 'ğŸ› ï¸',
                            url: file.name,
                            category: config.category || 'other',
                            features: Array.isArray(config.features) ? config.features : ['åœ¨çº¿å·¥å…·'],
                            status: config.status || '',
                            size: file.size ? formatFileSize(file.size) : 'è‡ªåŠ¨è·å–',
                            lastModified: 'åˆšåˆš',
                            fileSize: file.size || 0,
                            featured: config.featured || false,
                            hasConfig: true
                        };
                    } else {
                        // å¦‚æœæ²¡æœ‰é…ç½®ï¼Œæ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
                        return {
                            name: file.name.replace('.html', ''),
                            description: 'è¿™æ˜¯ä¸€ä¸ªHTMLå·¥å…·æ–‡ä»¶ï¼Œè¯·ç‚¹å‡»é…ç½®è¿›è¡Œè®¾ç½®',
                            icon: getAutoIcon(file.name),
                            url: file.name,
                            category: getAutoCategory(file.name),
                            features: ['å¾…é…ç½®'],
                            status: '',
                            size: file.size ? formatFileSize(file.size) : 'è‡ªåŠ¨è·å–',
                            lastModified: 'åˆšåˆš',
                            fileSize: file.size || 0,
                            featured: false,
                            hasConfig: false
                        };
                    }
                });

                console.log('ğŸ“Š æ‰€æœ‰å·¥å…·:', allTools);

                if (allTools.length > 0) {
                    displayTools(allTools);
                    totalTools.textContent = allTools.length;
                    htmlFiles.textContent = htmlFilesInRepo.length;
                    showStatus(`æˆåŠŸåŠ è½½ ${allTools.length} ä¸ªå·¥å…·`, 'success');
                } else {
                    showNoToolsMessage();
                }
                
            } catch (error) {
                console.log('GitHub APIå¤±è´¥:', error);
                // å¦‚æœGitHub APIå¤±è´¥ï¼Œå°è¯•ä»å·²çŸ¥æ–‡ä»¶åŠ è½½
                loadKnownFiles();
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        // åŠ è½½å·²çŸ¥æ–‡ä»¶ï¼ˆGitHub APIå¤±è´¥æ—¶çš„å›é€€æ–¹æ¡ˆï¼‰
        function loadKnownFiles() {
            console.log('ä½¿ç”¨å·²çŸ¥æ–‡ä»¶åˆ—è¡¨...');
            const htmlFiles = [
                {
                    name: "PDFè½¬JPGè½¬æ¢å™¨.html",
                    size: 0
                },
                {
                    name: "å°å­¦æ•°å­¦å¹³æ–¹åƒç±³å’Œå…¬é¡·çš„è®¤è¯†æ•™å­¦å·¥å…·.html", 
                    size: 0
                },
                {
                    name: "æ‰«é›·æ¸¸æˆ.html",
                    size: 0
                }
            ];

            allTools = htmlFiles.map(file => {
                const config = toolConfigs[file.name] || {};
                
                if (Object.keys(config).length > 0) {
                    return {
                        name: config.name || file.name.replace('.html', ''),
                        description: config.description || 'å®ç”¨çš„åœ¨çº¿å·¥å…·',
                        icon: config.icon || 'ğŸ› ï¸',
                        url: file.name,
                        category: config.category || 'other',
                        features: Array.isArray(config.features) ? config.features : ['åœ¨çº¿å·¥å…·'],
                        status: config.status || '',
                        size: 'è‡ªåŠ¨è·å–',
                        lastModified: 'åˆšåˆš',
                        fileSize: 0,
                        featured: config.featured || false,
                        hasConfig: true
                    };
                } else {
                    return {
                        name: file.name.replace('.html', ''),
                        description: 'è¿™æ˜¯ä¸€ä¸ªHTMLå·¥å…·æ–‡ä»¶ï¼Œè¯·ç‚¹å‡»é…ç½®è¿›è¡Œè®¾ç½®',
                        icon: getAutoIcon(file.name),
                        url: file.name,
                        category: getAutoCategory(file.name),
                        features: ['å¾…é…ç½®'],
                        status: '',
                        size: 'è‡ªåŠ¨è·å–',
                        lastModified: 'åˆšåˆš',
                        fileSize: 0,
                        featured: false,
                        hasConfig: false
                    };
                }
            });

            if (allTools.length > 0) {
                displayTools(allTools);
                document.getElementById('totalTools').textContent = allTools.length;
                document.getElementById('htmlFiles').textContent = allTools.length;
                showStatus(`åŠ è½½ ${allTools.length} ä¸ªå·¥å…·`, 'success');
            } else {
                showNoToolsMessage();
            }
        }

        // æ˜¾ç¤ºæ— å·¥å…·ä¿¡æ¯
        function showNoToolsMessage() {
            const toolsGrid = document.getElementById('toolsGrid');
            toolsGrid.innerHTML = `
                <div class="no-tools">
                    <div class="no-tools-icon">ğŸ“</div>
                    <h3>ä»“åº“ä¸­æ²¡æœ‰HTMLå·¥å…·æ–‡ä»¶</h3>
                    <p>è¯·ä½¿ç”¨ä¸Šæ–¹çš„ä¸Šä¼ åŠŸèƒ½æ·»åŠ HTMLæ–‡ä»¶åˆ°GitHubä»“åº“</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="showNewToolForm()">
                            <span>â•</span> æ·»åŠ å·¥å…·é…ç½®
                        </button>
                    </div>
                </div>
            `;
        }

        // æ˜¾ç¤ºå·¥å…·åˆ—è¡¨
        function displayTools(toolsList) {
            const toolsGrid = document.getElementById('toolsGrid');
            
            if (!toolsList || toolsList.length === 0) {
                showNoToolsMessage();
                return;
            }

            console.log('æ˜¾ç¤ºå·¥å…·åˆ—è¡¨:', toolsList);
            
            toolsGrid.innerHTML = toolsList.map(tool => `
                <div class="tool-card ${tool.featured ? 'featured' : ''}">
                    <div class="tool-icon">${tool.icon}</div>
                    <div class="tool-info">
                        <div class="tool-name">
                            <a href="${tool.url}" onclick="openTool('${tool.url}'); return false;">${tool.name}</a>
                            ${tool.status ? `<span class="tool-status status-${tool.status}">${
                                tool.status === 'new' ? 'æ–°' : 
                                tool.status === 'popular' ? 'çƒ­é—¨' : ''
                            }</span>` : ''}
                            ${tool.hasConfig ? '<span class="tool-status status-config">å·²é…ç½®</span>' : ''}
                        </div>
                        <div class="tool-description">${tool.description}</div>
                        <div class="tool-features">
                            ${tool.features.map(feature => `
                                <span class="feature-tag">${feature}</span>
                            `).join('')}
                        </div>
                        <div class="tool-actions">
                            <a href="${tool.url}" class="btn btn-primary" onclick="openTool('${tool.url}'); return false;">
                                <span>ğŸš€</span> ä½¿ç”¨å·¥å…·
                            </a>
                            <button class="btn btn-secondary" onclick="openConfig('${tool.url}')">
                                <span>âš™ï¸</span> ${tool.hasConfig ? 'ç¼–è¾‘' : 'é…ç½®'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // æ‰“å¼€å·¥å…·
        function openTool(toolUrl) {
            window.location.href = toolUrl;
        }

        // æ˜¾ç¤ºé…ç½®é¢æ¿
        function showConfigPanel() {
            const configPanel = document.getElementById('configPanel');
            configPanel.style.display = 'block';
        }

        // éšè—é…ç½®é¢æ¿
        function hideConfigPanel() {
            const configPanel = document.getElementById('configPanel');
            configPanel.style.display = 'none';
        }

        // æ˜¾ç¤ºæ–°å¢å·¥å…·è¡¨å•
        function showNewToolForm() {
            openConfig('');
        }

        // æ‰“å¼€å·¥å…·é…ç½®
        function openConfig(toolUrl) {
            const tool = toolUrl ? allTools.find(t => t.url === toolUrl) : null;
            
            const configForm = document.getElementById('configForm');
            configForm.innerHTML = `
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
                    <h4 style="margin: 0; color: #2e7d32;">${toolUrl ? 'ç¼–è¾‘å·¥å…·é…ç½®' : 'æ–°å¢å·¥å…·é…ç½®'}</h4>
                    <p style="margin: 8px 0 0; font-size: 0.9rem; color: #388e3c;">
                        é…ç½®å°†ä¿å­˜åˆ° tools-config.json æ–‡ä»¶
                    </p>
                </div>
                
                <input type="hidden" id="configFile" value="${toolUrl || ''}">
                
                <div class="form-group">
                    <label>HTMLæ–‡ä»¶å *</label>
                    <select id="configFileName" required>
                        <option value="">è¯·é€‰æ‹©HTMLæ–‡ä»¶...</option>
                        ${repositoryFiles
                            .filter(file => file.name.endsWith('.html') && file.name !== 'index.html')
                            .map(file => `<option value="${file.name}" ${file.name === toolUrl ? 'selected' : ''}>${file.name}</option>`)
                            .join('')}
                        <option value="custom">è‡ªå®šä¹‰æ–‡ä»¶å...</option>
                    </select>
                </div>
                
                <div class="form-group" id="customFileNameGroup" style="display: none;">
                    <label>è‡ªå®šä¹‰æ–‡ä»¶å *</label>
                    <input type="text" id="customFileName" placeholder="ä¾‹å¦‚: æ–°å·¥å…·.html">
                    <small style="color: #777;">å¿…é¡»ä»¥ .html ç»“å°¾</small>
                </div>
                
                <div class="form-group">
                    <label>æ˜¾ç¤ºåç§° *</label>
                    <input type="text" id="configName" value="${tool ? tool.name : ''}" placeholder="è¾“å…¥å·¥å…·æ˜¾ç¤ºåç§°" required>
                </div>
                
                <div class="form-group">
                    <label>æè¿° *</label>
                    <textarea id="configDescription" placeholder="è¾“å…¥å·¥å…·è¯¦ç»†æè¿°" required>${tool ? tool.description : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label>å›¾æ ‡</label>
                    <input type="text" id="configIcon" value="${tool ? tool.icon : 'ğŸ› ï¸'}" placeholder="è¾“å…¥è¡¨æƒ…ç¬¦å·å›¾æ ‡">
                    <small style="color: #777;">æ¨èï¼šğŸ“„â¡ï¸ğŸ–¼ï¸, ğŸ“ğŸ§®, ğŸ’£ğŸ®</small>
                </div>
                
                <div class="form-group">
                    <label>åˆ†ç±»</label>
                    <select id="configCategory">
                        <option value="pdf" ${tool && tool.category === 'pdf' ? 'selected' : ''}>PDFå·¥å…·</option>
                        <option value="game" ${tool && tool.category === 'game' ? 'selected' : ''}>æ¸¸æˆ</option>
                        <option value="education" ${tool && tool.category === 'education' ? 'selected' : ''}>æ•™è‚²å·¥å…·</option>
                        <option value="other" ${(!tool || tool.category === 'other') ? 'selected' : ''}>å…¶ä»–å·¥å…·</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ç‰¹æ€§æ ‡ç­¾ (ç”¨è‹±æ–‡é€—å·åˆ†éš”)</label>
                    <input type="text" id="configFeatures" value="${tool ? (Array.isArray(tool.features) ? tool.features.join(', ') : tool.features) : ''}" placeholder="ä¾‹å¦‚: PDFè½¬JPG, 300DPI, é«˜è´¨é‡">
                </div>
                
                <div class="form-group">
                    <label>çŠ¶æ€</label>
                    <select id="configStatus">
                        <option value="" ${!tool || !tool.status ? 'selected' : ''}>æ— </option>
                        <option value="new" ${tool && tool.status === 'new' ? 'selected' : ''}>æ–°å·¥å…·</option>
                        <option value="popular" ${tool && tool.status === 'popular' ? 'selected' : ''}>çƒ­é—¨å·¥å…·</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="configFeatured" ${tool && tool.featured ? 'checked' : ''}>
                        æ ‡è®°ä¸ºç‰¹è‰²å·¥å…·
                    </label>
                </div>
                
                <div class="config-actions">
                    <button type="button" class="save-config" onclick="saveConfigToGitHub()">ğŸ’¾ ä¿å­˜åˆ°GitHub</button>
                    <button type="button" class="cancel-config" onclick="hideConfigPanel()">å–æ¶ˆ</button>
                    ${toolUrl && tool && tool.hasConfig ? `<button type="button" class="delete-config" onclick="deleteConfig('${toolUrl}')">ğŸ—‘ï¸ åˆ é™¤é…ç½®</button>` : ''}
                </div>
            `;
            
            // æ·»åŠ é€‰æ‹©æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('configFileName').addEventListener('change', function(e) {
                const customGroup = document.getElementById('customFileNameGroup');
                if (e.target.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
            });
            
            showConfigPanel();
        }

        // æ”¹è¿›çš„ä¿å­˜é…ç½®åˆ°GitHubå‡½æ•°
async function saveConfigToGitHub() {
    const uploadStatus = document.getElementById('uploadStatus');
    
    try {
        let fileName;
        const selectValue = document.getElementById('configFileName').value;
        
        if (selectValue === 'custom') {
            fileName = document.getElementById('customFileName').value.trim();
            if (!fileName || !fileName.endsWith('.html')) {
                showStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„HTMLæ–‡ä»¶åï¼ˆå¿…é¡»ä»¥ .html ç»“å°¾ï¼‰', 'error');
                return;
            }
        } else {
            fileName = selectValue;
        }
        
        if (!fileName) {
            showStatus('è¯·é€‰æ‹©ä¸€ä¸ªHTMLæ–‡ä»¶', 'error');
            return;
        }

        const config = {
            name: document.getElementById('configName').value.trim(),
            description: document.getElementById('configDescription').value.trim(),
            icon: document.getElementById('configIcon').value.trim() || 'ğŸ› ï¸',
            category: document.getElementById('configCategory').value,
            features: document.getElementById('configFeatures').value
                .split(',')
                .map(f => f.trim())
                .filter(f => f),
            status: document.getElementById('configStatus').value,
            featured: document.getElementById('configFeatured').checked
        };

        // éªŒè¯å¿…å¡«å­—æ®µ
        if (!config.name || !config.description) {
            showStatus('è¯·å¡«å†™å¿…å¡«å­—æ®µï¼ˆåç§°å’Œæè¿°ï¼‰', 'error');
            return;
        }

        // æ›´æ–°é…ç½®å¯¹è±¡
        toolConfigs[fileName] = config;
        
        console.log('ä¿å­˜é…ç½®åˆ°GitHub:', fileName, config);

        // æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€
        uploadStatus.innerHTML = 'æ­£åœ¨éªŒè¯GitHubè¿æ¥...';
        uploadStatus.className = 'upload-status upload-success';
        uploadStatus.style.display = 'block';

        // é¦–å…ˆæµ‹è¯•GitHubè¿æ¥
        const testResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}`, {
            headers: getGitHubHeaders()
        });

        if (!testResponse.ok) {
            if (testResponse.status === 401) {
                throw new Error('GitHub Tokenæ— æ•ˆæˆ–è¿‡æœŸï¼Œè¯·æ£€æŸ¥Tokenæƒé™');
            } else if (testResponse.status === 403) {
                throw new Error('æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥Tokenæ˜¯å¦æœ‰ä»“åº“å†™å…¥æƒé™');
            } else if (testResponse.status === 404) {
                throw new Error('ä»“åº“ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®');
            } else {
                throw new Error(`GitHub APIé”™è¯¯: ${testResponse.status}`);
            }
        }

        // è·å–å½“å‰é…ç½®æ–‡ä»¶å†…å®¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        let currentSha = null;
        try {
            const fileResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/tools-config.json?ref=${BRANCH}`, {
                headers: getGitHubHeaders()
            });
            
            if (fileResponse.ok) {
                const fileData = await fileResponse.json();
                currentSha = fileData.sha;
                uploadStatus.innerHTML = 'æ‰¾åˆ°ç°æœ‰é…ç½®æ–‡ä»¶ï¼Œå‡†å¤‡æ›´æ–°...';
            } else if (fileResponse.status === 404) {
                uploadStatus.innerHTML = 'åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶...';
            } else {
                throw new Error(`è·å–æ–‡ä»¶å¤±è´¥: ${fileResponse.status}`);
            }
        } catch (error) {
            console.log('é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°æ–‡ä»¶');
            uploadStatus.innerHTML = 'åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶...';
        }

        // å‡†å¤‡æäº¤æ•°æ®
        const jsonContent = JSON.stringify(toolConfigs, null, 2);
        const content = btoa(unescape(encodeURIComponent(jsonContent)));
        const commitMessage = `æ›´æ–°å·¥å…·é…ç½®: ${fileName}`;
        
        const commitData = {
            message: commitMessage,
            content: content,
            branch: BRANCH
        };
        
        if (currentSha) {
            commitData.sha = currentSha;
        }

        uploadStatus.innerHTML = 'æ­£åœ¨ä¸Šä¼ é…ç½®åˆ°GitHub...';

        // æäº¤åˆ°GitHub
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/tools-config.json`, {
            method: 'PUT',
            headers: getGitHubHeaders(),
            body: JSON.stringify(commitData)
        });

        if (response.ok) {
            const result = await response.json();
            console.log('âœ… é…ç½®å·²ä¿å­˜åˆ°GitHub:', result);
            
            uploadStatus.innerHTML = `âœ… é…ç½®å·²æˆåŠŸä¿å­˜åˆ°GitHubä»“åº“<br>æäº¤SHA: ${result.commit.sha.substring(0, 8)}...`;
            uploadStatus.className = 'upload-status upload-success';
            
            // é‡æ–°åŠ è½½å·¥å…·åˆ—è¡¨
            await loadFiles();
            hideConfigPanel();
            
            showStatus('é…ç½®å·²æˆåŠŸä¿å­˜åˆ°GitHubä»“åº“', 'success');
        } else {
            const errorData = await response.json();
            console.error('GitHub APIé”™è¯¯è¯¦æƒ…:', errorData);
            
            if (errorData.message) {
                throw new Error(`GitHub: ${errorData.message}`);
            } else {
                throw new Error(`ä¿å­˜å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
            }
        }
        
    } catch (error) {
        console.error('ä¿å­˜é…ç½®åˆ°GitHubå¤±è´¥:', error);
        
        let errorMessage = error.message;
        
        // æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
        if (error.message.includes('Bad credentials')) {
            errorMessage = 'GitHub Tokenæ— æ•ˆï¼Œè¯·æ£€æŸ¥ï¼š<br>' +
                          '1. Tokenæ˜¯å¦æ­£ç¡®<br>' +
                          '2. Tokenæ˜¯å¦å·²è¿‡æœŸ<br>' +
                          '3. Tokenæ˜¯å¦æœ‰ä»“åº“å†™å…¥æƒé™';
        } else if (error.message.includes('Not Found')) {
            errorMessage = 'ä»“åº“ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥ä»“åº“åç§°å’Œæƒé™';
        }
        
        uploadStatus.innerHTML = `âŒ ${errorMessage}`;
        uploadStatus.className = 'upload-status upload-error';
        
        showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
    }
}

        // åˆ é™¤é…ç½®
        async function deleteConfig(fileName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ "${fileName}" çš„é…ç½®å—ï¼Ÿ`)) {
                try {
                    if (toolConfigs[fileName]) {
                        delete toolConfigs[fileName];
                        
                        // è·å–å½“å‰é…ç½®æ–‡ä»¶SHA
                        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/tools-config.json?ref=${BRANCH}`, {
                            headers: {
                                'Authorization': `token ${GITHUB_TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (response.ok) {
                            const fileData = await response.json();
                            const content = btoa(unescape(encodeURIComponent(JSON.stringify(toolConfigs, null, 2))));
                            
                            // æäº¤åˆ é™¤åˆ°GitHub
                            const deleteResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/tools-config.json`, {
                                method: 'PUT',
                                headers: {
                                    'Authorization': `token ${GITHUB_TOKEN}`,
                                    'Accept': 'application/vnd.github.v3+json',
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    message: `åˆ é™¤å·¥å…·é…ç½®: ${fileName}`,
                                    content: content,
                                    sha: fileData.sha,
                                    branch: BRANCH
                                })
                            });
                            
                            if (deleteResponse.ok) {
                                showStatus('é…ç½®å·²ä»GitHubä»“åº“åˆ é™¤', 'success');
                                await loadFiles();
                                hideConfigPanel();
                            } else {
                                throw new Error('åˆ é™¤å¤±è´¥');
                            }
                        }
                    }
                } catch (error) {
                    console.error('åˆ é™¤é…ç½®å¤±è´¥:', error);
                    showStatus('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                }
            }
        }

        // æ”¹è¿›çš„æ–‡ä»¶ä¸Šä¼ å‡½æ•°
async function uploadHTMLFile() {
    const fileInput = document.getElementById('htmlFileInput');
    const uploadStatus = document.getElementById('uploadStatus');
    
    if (!fileInput.files.length) {
        uploadStatus.textContent = 'è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„HTMLæ–‡ä»¶';
        uploadStatus.className = 'upload-status upload-error';
        uploadStatus.style.display = 'block';
        return;
    }
    
    const file = fileInput.files[0];
    if (!file.name.endsWith('.html') && !file.name.endsWith('.htm')) {
        uploadStatus.textContent = 'åªèƒ½ä¸Šä¼ HTMLæ–‡ä»¶ (.html æˆ– .htm)';
        uploadStatus.className = 'upload-status upload-error';
        uploadStatus.style.display = 'block';
        return;
    }
    
    try {
        uploadStatus.innerHTML = 'æ­£åœ¨éªŒè¯GitHubè¿æ¥...';
        uploadStatus.className = 'upload-status upload-success';
        uploadStatus.style.display = 'block';

        // æµ‹è¯•GitHubè¿æ¥
        const testResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}`, {
            headers: getGitHubHeaders()
        });

        if (!testResponse.ok) {
            if (testResponse.status === 401) {
                throw new Error('GitHub Tokenæ— æ•ˆæˆ–è¿‡æœŸ');
            }
            throw new Error(`GitHubè¿æ¥å¤±è´¥: ${testResponse.status}`);
        }

        uploadStatus.innerHTML = 'æ­£åœ¨è¯»å–æ–‡ä»¶å†…å®¹...';
        
        // è¯»å–æ–‡ä»¶å†…å®¹
        const fileContent = await readFileAsText(file);
        const encodedContent = btoa(unescape(encodeURIComponent(fileContent)));
        
        // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
        let currentSha = null;
        try {
            const checkResponse = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${encodeURIComponent(file.name)}?ref=${BRANCH}`, {
                headers: getGitHubHeaders()
            });
            
            if (checkResponse.ok) {
                const fileData = await checkResponse.json();
                currentSha = fileData.sha;
                uploadStatus.innerHTML = 'æ–‡ä»¶å·²å­˜åœ¨ï¼Œå‡†å¤‡æ›´æ–°...';
            }
        } catch (error) {
            uploadStatus.innerHTML = 'åˆ›å»ºæ–°æ–‡ä»¶...';
        }
        
        // å‡†å¤‡æäº¤æ•°æ®
        const commitData = {
            message: `ä¸Šä¼ HTMLå·¥å…·: ${file.name}`,
            content: encodedContent,
            branch: BRANCH
        };
        
        if (currentSha) {
            commitData.sha = currentSha;
        }
        
        uploadStatus.innerHTML = 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°GitHub...';
        
        // ä¸Šä¼ åˆ°GitHub
        const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${encodeURIComponent(file.name)}`, {
            method: 'PUT',
            headers: getGitHubHeaders(),
            body: JSON.stringify(commitData)
        });
        
        if (response.ok) {
            const result = await response.json();
            uploadStatus.innerHTML = `âœ… æ–‡ä»¶ "${file.name}" å·²æˆåŠŸä¸Šä¼ åˆ°GitHubä»“åº“<br>æäº¤SHA: ${result.commit.sha.substring(0, 8)}...`;
            uploadStatus.className = 'upload-status upload-success';
            
            // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
            fileInput.value = '';
            
            // è‡ªåŠ¨åˆ·æ–°å·¥å…·åˆ—è¡¨
            setTimeout(() => loadFiles(), 2000);
        } else {
            const errorData = await response.json();
            throw new Error(errorData.message || 'ä¸Šä¼ å¤±è´¥');
        }
        
    } catch (error) {
        console.error('ä¸Šä¼ æ–‡ä»¶å¤±è´¥:', error);
        
        let errorMessage = error.message;
        if (error.message.includes('Bad credentials')) {
            errorMessage = 'GitHub Tokenæ— æ•ˆï¼Œè¯·æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®é…ç½®';
        }
        
        uploadStatus.innerHTML = `âŒ ä¸Šä¼ å¤±è´¥: ${errorMessage}`;
        uploadStatus.className = 'upload-status upload-error';
    }
}
// æ·»åŠ TokenéªŒè¯åŠŸèƒ½
async function validateGitHubToken() {
    try {
        const response = await fetch('https://api.github.com/user', {
            headers: getGitHubHeaders()
        });
        
        if (response.ok) {
            const userData = await response.json();
            console.log('GitHub Tokenæœ‰æ•ˆï¼Œç”¨æˆ·:', userData.login);
            return { valid: true, user: userData.login };
        } else {
            return { valid: false, error: `çŠ¶æ€ç : ${response.status}` };
        }
    } catch (error) {
        return { valid: false, error: error.message };
    }
}

        // è¯»å–æ–‡ä»¶ä¸ºæ–‡æœ¬
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        // æŸ¥çœ‹ä»“åº“æ–‡ä»¶åˆ—è¡¨
        async function listRepositoryFiles() {
            const uploadStatus = document.getElementById('uploadStatus');
            
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents?ref=${BRANCH}`);
                if (response.ok) {
                    const files = await response.json();
                    const htmlFiles = files.filter(file => 
                        file.name.endsWith('.html') || 
                        file.name.endsWith('.htm')
                    );
                    
                    let htmlContent = '<strong>ğŸ“ ä»“åº“ä¸­çš„HTMLæ–‡ä»¶:</strong><br>';
                    
                    if (htmlFiles.length === 0) {
                        htmlContent += 'æš‚æ— HTMLæ–‡ä»¶<br><br>';
                    } else {
                        htmlFiles.forEach(file => {
                            const hasConfig = toolConfigs[file.name] ? ' âœ…' : ' â³';
                            htmlContent += `â€¢ ${file.name}${hasConfig}<br>`;
                        });
                        htmlContent += '<br><small>âœ… è¡¨ç¤ºå·²é…ç½®ï¼Œâ³ è¡¨ç¤ºå¾…é…ç½®</small><br><br>';
                    }
                    
                    htmlContent += '<strong>é…ç½®æ–‡ä»¶çŠ¶æ€:</strong><br>';
                    htmlContent += `â€¢ tools-config.json: ${Object.keys(toolConfigs).length > 0 ? 'âœ… å·²åŠ è½½' : 'âŒ æœªæ‰¾åˆ°'}<br>`;
                    htmlContent += `â€¢ å·²é…ç½®å·¥å…·: ${Object.keys(toolConfigs).length} ä¸ª`;
                    
                    uploadStatus.innerHTML = htmlContent;
                    uploadStatus.className = 'upload-status upload-success';
                    uploadStatus.style.display = 'block';
                } else {
                    throw new Error('æ— æ³•è·å–æ–‡ä»¶åˆ—è¡¨');
                }
            } catch (error) {
                uploadStatus.textContent = 'âŒ æ— æ³•è¿æ¥GitHubä»“åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                uploadStatus.className = 'upload-status upload-error';
                uploadStatus.style.display = 'block';
            }
        }

        // æœç´¢å·¥å…·
        function searchTools() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            currentSearch = searchTerm;
            
            if (!searchTerm) {
                filterTools(currentFilter);
                return;
            }
            
            const filteredTools = allTools.filter(tool => 
                tool.name.toLowerCase().includes(searchTerm) ||
                tool.description.toLowerCase().includes(searchTerm) ||
                tool.features.some(feature => feature.toLowerCase().includes(searchTerm))
            );
            
            displayTools(filteredTools);
        }

        // è¿‡æ»¤å·¥å…·
        function filterTools(filter) {
            currentFilter = filter;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            let filteredTools = allTools.filter(tool => {
                if (filter === 'all') return true;
                if (filter === 'popular') return tool.featured || tool.status === 'popular';
                if (filter === 'pdf') return tool.category === 'pdf';
                if (filter === 'game') return tool.category === 'game';
                if (filter === 'education') return tool.category === 'education';
                return tool.category === filter;
            });
            
            displayTools(filteredTools);
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 4000);
        }

        // å·¥å…·è¾…åŠ©å‡½æ•°
        function getAutoIcon(filename) {
            const name = filename.toLowerCase();
            if (name.includes('pdf') && name.includes('jpg')) return 'ğŸ“„â¡ï¸ğŸ–¼ï¸';
            if (name.includes('æ•°å­¦') || name.includes('å…¬é¡·') || name.includes('å¹³æ–¹åƒç±³')) return 'ğŸ“ğŸ§®';
            if (name.includes('æ‰«é›·')) return 'ğŸ’£ğŸ®';
            return 'ğŸ› ï¸';
        }

        function getAutoCategory(filename) {
            const name = filename.toLowerCase();
            if (name.includes('pdf')) return 'pdf';
            if (name.includes('æ‰«é›·')) return 'game';
            if (name.includes('æ•°å­¦') || name.includes('å…¬é¡·') || name.includes('å¹³æ–¹åƒç±³')) return 'education';
            return 'other';
        }

        function formatFileSize(bytes) {
            if (!bytes) return 'æœªçŸ¥';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
